name: Release Package  
  
on:  
  push:  
    tags:  
      - 'v*'
  
jobs:  
  build:  
    name: Build and release  
    runs-on: ubuntu-latest  
    steps:  
      - name: Checkout code  
        uses: actions/checkout@v2  
        with:  
          fetch-depth: 0
  
      - name: Extract tag name  
        id: extract_tag  
        run: echo "::set-output name=tag::${GITHUB_REF#refs/tags/}"  
  
      - name: Create Waila folder  
        run: mkdir Waila  
  
      - name: Copy files to Waila folder  
        run: |  
          cp Waila.js Waila/  
          cp manifest.json Waila/  
          cp Config.json Waila/  
          cp -r Language/ Waila/Language
  
      - name: Zip release  
        uses: vimtor/action-zip@v1  
        with:  
          files: Waila/*  
          dest: Waila-${{ steps.extract_tag.outputs.tag }}.zip  
  
      - name: Create Release  
        id: create_release  
        uses: actions/create-release@v1  
        env:  
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  
        with:  
          tag_name: ${{ github.ref }}  
          release_name: Release ${{ steps.extract_tag.outputs.tag }}  
          draft: false  
          prerelease: false  
  
      - name: Upload Release Asset  
        id: upload-release-asset   
        uses: actions/upload-release-asset@v1  
        env:  
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  
        with:  
          upload_url: ${{ steps.create_release.outputs.upload_url }} 
          asset_path: ./Waila-${{ steps.extract_tag.outputs.tag }}.zip  
          asset_name: Waila-${{ steps.extract_tag.outputs.tag }}.zip  
          asset_content_type: application/zip